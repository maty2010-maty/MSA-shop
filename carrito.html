<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carrito - MSA</title>
<link rel="stylesheet" href="style.css">
<style>
.carrito { padding: 40px 20px; text-align:center; }
.carrito ul { list-style:none; margin:20px 0; padding:0; }
.carrito ul li { background:#fff; margin:5px 0; padding:10px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
.btn-red { background:red; color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:18px; margin:10px; }
.btn-red:hover { background:darkred; transform:scale(1.05); }
#form-compra { display:none; margin-top:20px; text-align:left; max-width:600px; margin-left:auto; margin-right:auto; background:#f9f9f9; padding:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
#form-compra label { font-weight:bold; display:block; margin-top:10px; }
#form-compra input { width:100%; padding:10px; margin-top:5px; border-radius:6px; border:1px solid #ccc; font-size:16px; }
#procesando { display:none; text-align:center; font-size:20px; color:#0077cc; margin-top:30px; }
#procesando p { margin:10px 0; }
</style>
</head>
<body>

<header>
<div class="logo">MSA</div>
<nav><ul><li><a href="index.html" class="carrito-icono">üè† Volver</a></li></ul></nav>
</header>

<section class="carrito">
<h2>üõí Carrito de Compras</h2>
<ul id="lista-carrito"></ul>
<p id="total">Total: $0 MXN</p>
<button class="btn-red" id="btn-vaciar">Vaciar Carrito</button>
<button class="btn-red" id="btn-proceder">Proceder con la compra</button>

<form id="form-compra">
<label for="nombre">Nombre completo:</label>
<input type="text" id="nombre" required>
<label for="email">Correo electr√≥nico:</label>
<input type="email" id="email" required>
<label for="telefono">Tel√©fono:</label>
<input type="tel" id="telefono" required>
<label for="direccion">Direcci√≥n de env√≠o:</label>
<input type="text" id="direccion" required>
<label for="ciudad">Ciudad:</label>
<input type="text" id="ciudad" required>
<label for="codigo">C√≥digo postal:</label>
<input type="text" id="codigo" required>
<button type="submit" class="btn-red">Comprar</button>
</form>

<div id="procesando">
<p>‚úÖ Su compra ha sido procesada</p>
<p>üìß Recibir√° un correo de confirmaci√≥n</p>
<p>üöÄ Su pedido est√° en camino</p>
</div>
</section>

<!-- EmailJS y JavaScript del carrito -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
// Inicializar EmailJS
emailjs.init('PhV4Hp36EPOLiGe6t');

// Funci√≥n para obtener el carrito
function obtenerCarrito() {
  return JSON.parse(localStorage.getItem("carrito")) || [];
}

// Mostrar el carrito en la p√°gina
function mostrarCarrito() {
  const lista = document.getElementById("lista-carrito");
  const totalTexto = document.getElementById("total");
  const carrito = obtenerCarrito();
  lista.innerHTML = "";
  let total = 0;

  carrito.forEach((item, index) => {
    total += item.precio;

    const li = document.createElement("li");
    li.style.display = "flex";
    li.style.justifyContent = "space-between";
    li.style.alignItems = "center";
    li.style.marginBottom = "5px";

    const textSpan = document.createElement("span");
    textSpan.textContent = `${item.nombre} - Talla: ${item.talla || 'N/A'}${item.color ? ", Color: " + item.color : ""} - $${item.precio} MXN`;

    const btnEliminar = document.createElement("button");
    btnEliminar.textContent = "Eliminar";
    btnEliminar.classList.add("btn-red");
    btnEliminar.style.padding = "5px 10px";
    btnEliminar.style.fontSize = "14px";
    btnEliminar.addEventListener("click", () => {
      const carritoActualizado = obtenerCarrito();
      carritoActualizado.splice(index, 1);
      localStorage.setItem("carrito", JSON.stringify(carritoActualizado));
      mostrarCarrito();
    });

    li.appendChild(textSpan);
    li.appendChild(btnEliminar);
    lista.appendChild(li);
  });

  totalTexto.textContent = `Total: $${total} MXN`;
  
  // Mostrar/ocultar bot√≥n de proceder seg√∫n si hay productos
  const btnProceder = document.getElementById("btn-proceder");
  if (carrito.length === 0) {
    btnProceder.style.display = "none";
  } else {
    btnProceder.style.display = "block";
  }
}

// Vaciar carrito
document.getElementById("btn-vaciar").addEventListener("click", () => {
  localStorage.removeItem("carrito");
  mostrarCarrito();
});

// Mostrar formulario de compra
const btnProceder = document.getElementById("btn-proceder");
const formCompra = document.getElementById("form-compra");

btnProceder.addEventListener("click", () => {
  formCompra.style.display = "block";
  btnProceder.style.display = "none";
});

// Enviar formulario con EmailJS
formCompra.addEventListener("submit", async (e) => {
  e.preventDefault();

  const confirmacion = confirm("¬øEst√°s seguro que deseas realizar la compra?");
  if (!confirmacion) {
    alert("Compra cancelada");
    return;
  }

  const nombre = document.getElementById("nombre").value;
  const email = document.getElementById("email").value;
  const telefono = document.getElementById("telefono").value;
  const direccion = document.getElementById("direccion").value;
  const ciudad = document.getElementById("ciudad").value;
  const codigo = document.getElementById("codigo").value;

  const carritoActual = obtenerCarrito();
  if (carritoActual.length === 0) {
    alert("El carrito est√° vac√≠o.");
    return;
  }

  const productos = carritoActual.map(p => 
    `${p.nombre} - Talla: ${p.talla || 'N/A'}, Color: ${p.color || 'N/A'} - $${p.precio} MXN`
  ).join("\n");

  const total = carritoActual.reduce((acc, p) => acc + p.precio, 0);

  try {
    // REEMPLAZA 'TU_SERVICE_ID' y 'TU_TEMPLATE_ID' con tus IDs reales de EmailJS
    await emailjs.send('TU_SERVICE_ID', 'TU_TEMPLATE_ID', {
      nombre: nombre,
      email: email,
      telefono: telefono,
      direccion: direccion,
      ciudad: ciudad,
      codigo_postal: codigo,
      productos: productos,
      total: `$${total} MXN`,
      fecha: new Date().toLocaleDateString()
    });
    
    alert("‚úÖ Pedido enviado correctamente!");
    formCompra.style.display = "none";
    
    // Mostrar mensaje de procesamiento
    const procesandoElement = document.getElementById("procesando");
    if (procesandoElement) {
      procesandoElement.style.display = "block";
    }
    
    localStorage.removeItem("carrito");
    mostrarCarrito();
    formCompra.reset();
  } catch (error) {
    console.error("Error al enviar el pedido:", error);
    alert("‚ùå Error al enviar el pedido. Por favor, intenta nuevamente.");
  }
});

// Inicializar carrito al cargar la p√°gina
document.addEventListener("DOMContentLoaded", mostrarCarrito);
</script>

</body>
</html>